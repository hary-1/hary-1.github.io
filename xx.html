<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<title></title>
		<style type="text/css">
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box
			}
			
			#box {
				margin: 0 auto;
				position: relative;
				height: 901px;
				width: 901px;
				border-right: 1px solid black;
				border-bottom: 1px solid black;
			}
			
			.box1 {
				position: absolute;
				height: 45px;
				width: 45px;
				line-height: 45px;
				text-align: center;
				background-color: white;
				border-left: 1px solid black;
				border-top: 1px solid black;
				/*opacity: 0;*/
			}
			
			.box2 {
				position: absolute;
				height: 45px;
				width: 45px;
				line-height: 45px;
				text-align: center;
				background-color: #ccc;
				border-left: 1px solid black;
				border-top: 1px solid black;
				z-index: 2;
			}
			
			#tc {
				position: absolute;
				top: 200px;
				left: 750px;
				height: 300px;
				width: 500px;
				font-size: 32px;
				line-height: 200px;
				text-align: center;
				z-index: 100;
				display: none;
				background-color: white;
				border: 1px solid black;
			}
			
			button {
				position: absolute;
				left: 220px;
				top: 180px;
			}
		</style>
	</head>

	<body>
		<div id="box">

		</div>
		<div id="tc">
			请再接再厉。
			<button>重新开始</button>
		</div>
		<script type="text/javascript">
			"use strict"
			window.onload = function() {
				//获取元素
				let tc = document.getElementById('tc');
				let box = document.getElementById('box');
				//创建div
				for(let e = 0; e < 20; e++) {
					let y = 45 * e;
					for(let i = 0; i < 20; i++) {
						let div = document.createElement('div');
						div.setAttribute('class', 'box1')
						div.style.left = 45 * i + 'px';
						div.style.top = y + 'px';
						box.appendChild(div);
					}

				}
				//创建遮盖层的格子
				for(let e = 0; e < 20; e++) {
					let y = 45 * e;
					for(let i = 0; i < 20; i++) {
						let div = document.createElement('div');
						div.setAttribute('class', 'box2');
						div.style.left = 45 * i + 'px';
						div.style.top = y + 'px';
						box.appendChild(div);
					}

				}
				let divs = document.querySelectorAll('#box>.box1');
				//声明一个空数组
				let arrty = [];
				//利用for生成一个数组
				for(let p = 0; p < divs.length; p++) {
					arrty[arrty.length] = p;
				}
				//声明一个空数组,用来装炸弹的索引值;
				let arrty2 = [];
				//				console.log(divs);
				//随机在这个divs里面放入40个炸弹
				for(let i = 0; i < 50; i++) {
					//在0到arrty长度之间随机数,这里会有可能随机出一样的数字，需要重新判断
					let a = Math.floor(Math.random() * (arrty.length));
					arrty2[arrty2.length] = arrty.splice(a, 1);
				}
				//				console.log(arrty2[1][0]);
				//声明一个新的空数组，放置炸弹
				let arr = [];
				//遍历divs
				for(let j = 0; j < arrty2.length; j++) {
					let r = arrty2[j][0];
					//					console.log(r);
					arr[arr.length] = r;
					divs[r].style.backgroundColor = 'red';
				}
				//				console.log(arr);
				for(let p = 0; p < divs.length; p++) {
					if(divs[p].style.backgroundColor == 'red') {
						continue;
					} else {
						//声明一个变量，用来记录炸弹有几个；
						let zd = 0;
						//在这里查找当前的周围的八个格子的索引值是否在这个炸弹数组里
						let a1 = arr.findIndex(function(a) {
							return a == p + 1;
						});
						let a2 = arr.findIndex(function(a) {
							return a == p - 1;
						});
						let a3 = arr.findIndex(function(a) {
							return a == p + 20;
						});
						let a4 = arr.findIndex(function(a) {
							return a == p - 20;
						});
						let a5 = arr.findIndex(function(a) {
							return a == p + 21;
						});
						let a6 = arr.findIndex(function(a) {
							return a == p + 19;
						});
						let a7 = arr.findIndex(function(a) {
							return a == p - 21;
						});
						let a8 = arr.findIndex(function(a) {
							return a == p - 19;
						});
						//因为格子的最左边和最右边的周围范围就变到右边和左边，比如当前盒子是20的索引，他的p-1 =19，会跑到第二排的最后一个就会，如果19是炸弹就会影响当前记录炸弹的个数，所以需要先判断
						if(p % 20 == 0) {
							a2 = -1;
							a7 = -1;
							a6 = -1;
						}
						if(p % 20 == 19) {
							a1 = -1;
							a8 = -1;
							a5 = -1;
						}
						let arrty = [a1, a2, a3, a4, a5, a6, a7, a8];
						//						console.log(arrty);
						//没查到就会返回-1，只需要判断不是-1的值，那么就是炸弹

						for(let i = 0; i < arrty.length; i++) {
							if(arrty[i] != -1) {
								zd++;
							}
						}
						if(zd == 0) {
							zd = '';
						}
						//					console.log(zd);
						divs[p].innerHTML = zd;
					}

				}
				//获取遮盖层的小格子
				let boxs = document.querySelectorAll('.box2');

				//声明一个空数组，装取有数字的格子的索引值
				let arr2 = [];
				//获取有数字的格子的索引值
				for(let k = 0; k < divs.length; k++) {
					if(divs[k].innerHTML != '') {
						arr2[arr2.length] = k;
					}
				}
				console.log(arr2);

				//遍历给每一个小格子
				for(let g = 0; g < boxs.length; g++) {
					//给小格子设置鼠标右键事件
					boxs[g].onmousedown = function(e){
						if(e == 2){
							alert('nidianjile1');
							this.innerHTML = '*';
						}
					}
					//给每一个小格子设置点击事件
					boxs[g].onclick = function() {
						//是炸弹的时候
						if(divs[g].style.backgroundColor == 'red') {
							fn();
							return;
							//                          this.onclick = null;
						}else if(divs[g].innerHTML != ''){
							this.style.zIndex = -2;
							return;
						}
						//不是炸弹的时候
						else {
							this.style.zIndex = -2;
							xianshi([g]);
						}
					}
				}

				//声明一个变量，记录定时器的id
				let timeId = null;
				//封装一个函数，作用一个一个的显示炸弹。
				function fn() {
					let i = 0;
					//					let a = 0;
					timeId = setInterval(function() {
						//						a = arr[i];
						if(i >= arr.length) {
							clearInterval(timeId);

							tc.style.display = 'block';

						} else {
							boxs[arr[i]].style.zIndex = -2;
						}
						console.log(i);
						i++;
					}, 20)
				}
				//声明一个变量，记录定时器的id
				let timerId = null;
				//封装一个函数，作用空白的显示规则
				//思路，点击这个不是炸弹的时候，显示当前这个，然后判断周围的八个格子，如果当中有不是炸弹的就显示
				//，并且把这些格子的索引添加在一个数组中，然后用定时器，把这个数组中的索引开始遍历，再判断这些周围
				//的八个格子是否为炸弹，重复这个添加再数组，然后判断，直到这个数组为0停止定时器。
				function xianshi(numArr) {
					//console.log(numArr.length);
					//声明一个数组，装取这些格子
					let arr3 = [];
					//声明一个空数组,装这些出现过的格子
					let arr4 = [];
					let f = numArr.length;
					timerId = setInterval(function() {
						console.log(f);
						//判断如果numArr为0时停止定时器
						if(f > 0) {
							//判断如果numArr不为0时
							for(let c = 0; c < f; c++) {
								let num = numArr[c];
								arr4[arr4.length] = num;
								console.log(num);
								//声明周围的八个格子
								let a1 = num + 1;
								let a2 = num - 1;
								let a3 = num + 20;
								let a4 = num - 20;
								//声明一个数组，装取这些格子
								arr3 = [a1, a2, a3, a4]
								//如果是最左边时
								if(num % 20 == 0) {
									arr3.splice(1, 1);
								}//如果时最右边时
								else if(num % 20 == 19) {
									arr3.splice(0, 1);
								}
								//排除大于399或者小于0
								for(let i = 0; i < arr3.length; i++) {
									if(arr3[i] < 0) {
										arr3.splice(i, 1);
									} else if(arr3[i] > 399) {
										arr3.splice(i, 1);
									}
								}
								console.log(arr3);
								console.log(arr4);
								let t = arr3.length;
								//判断这些格子
								for(let a = 0; a < t; a++) {
									let r = arr3[a];
									console.log(r);
									//先判断这个数组里的有没有炸弹
									let c1 = arr.findIndex(function(a) {
							            return a == r;
						           });
						            let c2 = arr2.findIndex(function(a){
						            	return a == r;
						            })
						            let c3 = arr4.findIndex(function(a){
						            	return a == r;
						            })
						            console.log(c1,c2,c3);
						            if(c1 != -1){
						            	arr3.splice(a,1);
						            	return;
//						            	continue;
						            }
						            else if(c2 != -1){
						            	
						            	boxs[r].style.zIndex = 99;
						            	arr3.splice(a,1);
						            	return;
//						            	continue;
						            }
						            else if(c3 != -1) {
						            	return;
						            	arr3.splice(a,1);
						            }else{
						            	console.log(arr3);
						            	boxs[r].style.zIndex = -2;
						            }
						            
								}
								console.log(arr3);

							}
							f = arr3.length;
							numArr = arr3;

						} else {
//							console.log('a');
							clearInterval(timerId);
						}
//						console.log(arr3);
						//							console.log('haha');
						
					}, 10)

				}
//				let add = 0;
//				for (let f=0;f<boxs.length;f++) {
//					if(this.style.zIndex == 2){
//						add++;
//					}
//				}
//				if(add == lei){
//					alert('你赢了！');
//				}
				
			}
			//最后点击的规则就是从这个点击的格子四周扩散，直到周围都是数字为止。
		</script>
	</body>

</html>